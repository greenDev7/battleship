(function(){"use strict";var t={5089:function(t,e,n){var i=n(5130),a=n(6768);const s={class:"navbar navbar-expand navbar-dark bg-dark mb-5"},o={class:"navbar-nav container"},r={class:"d-flex flex-row w-100 justify-content-evenly"};function l(t,e){const n=(0,a.g2)("router-link"),i=(0,a.g2)("router-view");return(0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.Lk)("nav",s,[(0,a.Lk)("div",o,[(0,a.Lk)("div",r,[(0,a.bF)(n,{class:"nav-item nav-link",to:"/"},{default:(0,a.k6)((()=>e[0]||(e[0]=[(0,a.eW)("Морской бой")]))),_:1})])])]),(0,a.bF)(i)],64)}var c=n(1241);const d={},h=(0,c.A)(d,[["render",l]]);var u=h,g=n(1387),m=n(4232);const p={class:"container"},y={key:0,class:"border border-secondary border-3 rounded-3 p-1 wfit mx-auto mb-4"},S={class:"d-flex flex-row flex-wrap mb-3 justify-content-center"},f={class:"w-100 maxw-400 pb-3 me-lg-5"},_=["disabled"],k={class:"w-100 maxw-400 pb-3 ms-lg-5"},v={key:1,class:"border border-dark border-2 rounded-3 mx-auto wfit mb-4"},C={key:2,class:"mx-auto wfit mb-4"},b=["disabled"],E={key:3,class:"border border-dark border-2 rounded-3 wfit mx-auto mb-4"},A={class:"d-flex flex-row flex-wrap mt-4 mb-4 mt-lg-3 justify-content-center"},I={class:"minw-17"},w=["disabled"],L={class:"position-fixed alpos"};function N(t,e,n,s,o,r){const l=(0,a.g2)("CaptchaComponent"),c=(0,a.g2)("FriendGameComponent"),d=(0,a.g2)("ArrangementRuleComponent"),h=(0,a.g2)("StateInfoComponent"),u=(0,a.g2)("GameOverInfoComponent"),g=(0,a.g2)("BattleBoardComponent");return(0,a.uX)(),(0,a.CE)("div",p,[(0,a.bo)((0,a.Lk)("input",{class:"form-control form-control-lg mb-4",placeholder:"Введите ник",type:"text","onUpdate:modelValue":e[0]||(e[0]=e=>t.nickName=e)},null,512),[[i.Jo,t.nickName]]),this.captchaVisible?((0,a.uX)(),(0,a.CE)("div",y,[(0,a.bF)(l,{onCaptchaOkButtonClicked:t.processCaptcha},null,8,["onCaptchaOkButtonClicked"])])):(0,a.Q3)("",!0),(0,a.Lk)("div",S,[(0,a.Lk)("div",f,[(0,a.Lk)("button",{class:"btn btn-lg btn-dark p-3 w-100 text-nowrap",type:"button",onClick:e[1]||(e[1]=(...e)=>t.handleRandomGameButtonClick&&t.handleRandomGameButtonClick(...e)),disabled:t.topButtonDisabled}," Игра со случайным соперником ",8,_)]),(0,a.Lk)("div",k,[(0,a.Lk)("button",{class:"btn btn-lg btn-dark p-3 w-100 text-nowrap",type:"button",onClick:e[2]||(e[2]=(...e)=>t.handleFriendGameButtonClick&&t.handleFriendGameButtonClick(...e))}," Игра с другом ")])]),t.isFriendGameNotCreated()?((0,a.uX)(),(0,a.CE)("div",v,[(0,a.bF)(c,{clientUUID:t.clientUUID,onFriendUUIDUpdated:t.validateAndSetFriendUUID,friendInputDisabled:t.friendInputDisabled},null,8,["clientUUID","onFriendUUIDUpdated","friendInputDisabled"])])):(0,a.Q3)("",!0),t.isFriendGameNotCreated()?((0,a.uX)(),(0,a.CE)("div",C,[(0,a.Lk)("button",{class:"btn btn-lg btn-dark p-3 text-nowrap minw-17",type:"button",disabled:t.topButtonDisabled,onClick:e[3]||(e[3]=(...e)=>t.handleCreateFriendGameButtonClick&&t.handleCreateFriendGameButtonClick(...e))}," Создать игру ",8,b)])):(0,a.Q3)("",!0),t.isPlaying?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",E,[(0,a.bF)(d)])),t.isStateInfoComponentVisible()?((0,a.uX)(),(0,a.Wv)(h,{key:4,enemyNickName:t.getEnemyNickname,enemyState:t.getEnemyState,myState:t.getMyState},null,8,["enemyNickName","enemyState","myState"])):(0,a.Q3)("",!0),5===t.getMyState?((0,a.uX)(),(0,a.Wv)(u,{key:5,isWinner:t.getIsWinner},null,8,["isWinner"])):(0,a.Q3)("",!0),(0,a.bF)(g,{isMyTurnToShoot:t.getIsMyTurnToShoot,turnOrderHintsVisible:4===t.getMyState,enemyShotHint:t.getEnemyShotHint,enemyNickname:t.getEnemyNickname},null,8,["isMyTurnToShoot","turnOrderHintsVisible","enemyShotHint","enemyNickname"]),(0,a.Lk)("div",A,[(0,a.Lk)("div",I,[(0,a.Lk)("button",{ref:"playButton",class:"btn btn-lg btn-success w-100 text-nowrap",type:"button",onClick:e[4]||(e[4]=(...e)=>t.handlePlayButtonClick&&t.handlePlayButtonClick(...e)),disabled:!t.isPlayButtonEnabled()},(0,m.v_)(t.getPlayButtonCaption()),9,w)])]),(0,a.Lk)("div",L,[(0,a.bo)((0,a.Lk)("div",{class:(0,m.C4)(["alert alert-dismissible fade show",`alert-${t.getAlert.alertColor}`]),role:"alert"},[(0,a.eW)((0,m.v_)(t.getAlert.alertText)+" ",1),(0,a.Lk)("button",{type:"button",class:"btn-close","aria-label":"Close",onClick:e[5]||(e[5]=(...e)=>t.hideAlert&&t.hideAlert(...e))})],2),[[i.aG,t.getAlert.alertVisible]])])])}const T={class:"container"},O={class:"d-flex flex-row flex-wrap justify-content-lg-center justify-content-sm-between text-center"},R={class:"me-lg-2 mb-4 border border-dark border-2 rounded-3 p-2"},H={class:"ms-lg-2 mb-4 border border-dark border-2 rounded-3 p-2"},x={class:"blink fw-bold green"};function G(t,e,n,s,o,r){const l=(0,a.g2)("BattleGridWithCaptionsComponent");return(0,a.uX)(),(0,a.CE)("div",T,[(0,a.Lk)("div",O,[(0,a.Lk)("div",R,[(0,a.Lk)("table",null,[(0,a.Lk)("tbody",null,[(0,a.Lk)("tr",null,[(0,a.Lk)("td",null,[(0,a.bo)((0,a.Lk)("span",{class:(0,m.C4)([{blink:!t.isMyTurnToShoot},"fw-bold darkred"])},[(0,a.bo)((0,a.Lk)("span",null,"ходит ",512),[[i.aG,!t.isMyTurnToShoot]]),(0,a.Lk)("span",null,(0,m.v_)(t.enemyNickname+" "),1),(0,a.bo)((0,a.Lk)("span",null,(0,m.v_)(t.enemyShotHint),513),[[i.aG,t.enemyShotHint]])],2),[[i.aG,t.turnOrderHintsVisible]]),e[0]||(e[0]=(0,a.Lk)("span",null," ",-1))])]),(0,a.Lk)("tr",null,[(0,a.Lk)("td",null,[(0,a.bF)(l)])])])])]),(0,a.Lk)("div",H,[(0,a.Lk)("table",null,[(0,a.Lk)("tbody",null,[(0,a.Lk)("tr",null,[(0,a.Lk)("td",null,[(0,a.bo)((0,a.Lk)("span",x,"ваш ход",512),[[i.aG,t.turnOrderHintsVisible&t.isMyTurnToShoot]]),e[1]||(e[1]=(0,a.Lk)("span",null," ",-1))])]),(0,a.Lk)("tr",null,[(0,a.Lk)("td",null,[(0,a.bF)(l,{gridType:t.hostileGrid},null,8,["gridType"])])])])])])])])}function D(t,e,n,i,s,o){const r=(0,a.g2)("BattleGridComponent");return(0,a.uX)(),(0,a.CE)("table",null,[(0,a.Lk)("tbody",null,[(0,a.Lk)("tr",null,[e[1]||(e[1]=(0,a.Lk)("td",null,null,-1)),(0,a.Lk)("td",{style:(0,m.Tr)({width:t.getCanvasWidth+"px"})},e[0]||(e[0]=[(0,a.Fv)('<table id="alphabeticTable" data-v-2a081d56><tbody data-v-2a081d56><tr data-v-2a081d56><td data-v-2a081d56>а</td><td data-v-2a081d56>б</td><td data-v-2a081d56>в</td><td data-v-2a081d56>г</td><td data-v-2a081d56>д</td><td data-v-2a081d56>е</td><td data-v-2a081d56>ж</td><td data-v-2a081d56>з</td><td data-v-2a081d56>и</td><td data-v-2a081d56>к</td></tr></tbody></table>',1)]),4)]),(0,a.Lk)("tr",{style:(0,m.Tr)({height:t.getCanvasHeight+"px"})},[e[2]||(e[2]=(0,a.Lk)("td",{id:"digitCell"},[(0,a.Lk)("table",{id:"digitTable"},[(0,a.Lk)("tbody",null,[(0,a.Lk)("tr",null,[(0,a.Lk)("td",null,"1")]),(0,a.Lk)("tr",null,[(0,a.Lk)("td",null,"2")]),(0,a.Lk)("tr",null,[(0,a.Lk)("td",null,"3")]),(0,a.Lk)("tr",null,[(0,a.Lk)("td",null,"4")]),(0,a.Lk)("tr",null,[(0,a.Lk)("td",null,"5")]),(0,a.Lk)("tr",null,[(0,a.Lk)("td",null,"6")]),(0,a.Lk)("tr",null,[(0,a.Lk)("td",null,"7")]),(0,a.Lk)("tr",null,[(0,a.Lk)("td",null,"8")]),(0,a.Lk)("tr",null,[(0,a.Lk)("td",null,"9")]),(0,a.Lk)("tr",null,[(0,a.Lk)("td",null,"10")])])])],-1)),(0,a.Lk)("td",null,[(0,a.bF)(r,{"grid-type":t.gridType},null,8,["grid-type"])])],4)])])}const P={ref:"canvas"};function M(t,e,n,i,s,o){return(0,a.uX)(),(0,a.CE)("div",{style:(0,m.Tr)({height:t.getCanvasHeight+"px"})},[(0,a.Lk)("canvas",P,null,512)],4)}n(8992),n(3949);var U,F=n(1114),W=(n(4114),n(782));n(4520),n(1454);(function(t){t[t["NOT_CREATED"]=0]="NOT_CREATED",t[t["SEARCHING_FOR_OPPONENT"]=1]="SEARCHING_FOR_OPPONENT",t[t["SHIPS_POSITIONING"]=2]="SHIPS_POSITIONING",t[t["SHIPS_ARE_ARRANGED"]=3]="SHIPS_ARE_ARRANGED",t[t["PLAYING"]=4]="PLAYING",t[t["GAME_IS_OVER"]=5]="GAME_IS_OVER",t[t["WAITING_FOR_FRIEND"]=6]="WAITING_FOR_FRIEND"})(U||(U={}));var B,V=U;(function(t){t[t["RANDOM"]=1]="RANDOM",t[t["FRIEND"]=2]="FRIEND",t[t["COMPUTER"]=3]="COMPUTER"})(B||(B={}));var X,Y=B;(function(t){t[t["GAME_CREATION"]=0]="GAME_CREATION",t[t["SHIPS_ARE_ARRANGED"]=1]="SHIPS_ARE_ARRANGED",t[t["PLAY"]=2]="PLAY",t[t["FIRE_REQUEST"]=3]="FIRE_REQUEST",t[t["FIRE_RESPONSE"]=4]="FIRE_RESPONSE",t[t["UNSUNK_SHIPS"]=5]="UNSUNK_SHIPS",t[t["GAME_OVER"]=6]="GAME_OVER",t[t["DISCONNECTION"]=7]="DISCONNECTION",t[t["PLAY_AGAIN"]=8]="PLAY_AGAIN"})(X||(X={}));var z,j=X;n(3215),n(2577);(function(t){t[t["Horizontal"]=0]="Horizontal",t[t["Vertical"]=1]="Vertical"})(z||(z={}));var Q,$=z;(function(t){t["CIRCLE"]="Circle",t["SQUARE"]="Square",t["CROSS"]="Cross"})(Q||(Q={}));var K=Q;const J={0:"а",1:"б",2:"в",3:"г",4:"д",5:"е",6:"ж",7:"з",8:"и",9:"к"};class q{constructor(t,e){(0,F.A)(this,"_x",void 0),(0,F.A)(this,"_y",void 0),(0,F.A)(this,"toString",(()=>`(${J[this._x]}-${this._y+1})`)),this._x=t,this._y=e}get x(){return this._x}set x(t){this._x=t}get y(){return this._y}set y(t){this._y=t}static getLocationByOffsetXY(t,e){const n=st.state;let i=st.getters.getGridCellWidth(n),a=st.getters.getGridCellHeight(n),s=Math.floor(t/i),o=Math.floor(e/a);return new q(s,o)}async highlight(t,e=K.CIRCLE){if(t){const n=st.state;let i=st.getters.getGridCellWidth(n),a=st.getters.getGridCellHeight(n);if(t.save(),e===K.SQUARE)t.fillStyle="rgb(229 22 35)",t.fillRect(this._x*i+3,this._y*a+3,i-6,a-6);else if(e===K.CIRCLE){t.fillStyle="rgb(33 22 235)";const e=new Path2D;let n=st.state.scaleParameter;e.arc(this._x*i+.5*i,this._y*a+.5*a,5*n,0,2*Math.PI),t.fill(e)}else t.strokeStyle="rgb(229 22 35)",t.lineWidth=3,t.beginPath(),t.moveTo(this._x*i+5,this._y*a+5),t.lineTo((this._x+1)*i-5,(this._y+1)*a-5),t.moveTo((this._x+1)*i-5,this._y*a+5),t.lineTo(this._x*i+5,(this._y+1)*a-5),t.stroke();t.restore()}}outsideTheGrid(){return this._x<0||this._x>9||this._y<0||this._y>9}isValid(){return this._x>=0&&this._x<=9&&this._y>=0&&this._y<=9}}class Z{static getShips(){return Z.ships}static createInitialShips(){Z.ships=[new ct(1,$.Horizontal,new q(8,2)),new ct(1,$.Horizontal,new q(0,9)),new ct(1,$.Horizontal,new q(7,5)),new ct(1,$.Horizontal,new q(8,8)),new ct(2,$.Horizontal,new q(0,0)),new ct(2,$.Vertical,new q(4,3)),new ct(2,$.Vertical,new q(1,2)),new ct(3,$.Horizontal,new q(5,0)),new ct(3,$.Horizontal,new q(4,9)),new ct(4,$.Vertical,new q(2,6))]}static refreshGridAndShips(){const t=st.state,e=st.getters.getContext2D(t),n=st.getters.getHostileContext2D(t);Z.clearGrid(e),Z.clearGrid(n),Z.makeGrid(e),Z.makeGrid(n),Z.createInitialShips(),Z.ships.forEach((t=>{t.draw(e)}))}static clearGrid(t){t.clearRect(0,0,t.canvas.width,t.canvas.height)}static existsInShotHistory(t){return this.containsLocation(t,Z.shotHistory)}static createInitialRandomShips(){}static isArrangementCorrect(){let t=[];for(let e=0;e<Z.ships.length-1;e++){const n=Z.ships[e];for(let i=e+1;i<Z.ships.length;i++){const e=Z.ships[i],a=n.isIntersect(e);a[0]&&Array.prototype.push.apply(t,[a[1],a[2]])}}return t.length>0?[!1,t]:[!0,void 0]}static getShipByHeadLocation(t){return Z.ships.find((e=>e.location.x===t.x&&e.location.y===t.y))}static getShipByLocation(t){let e=Z.ships.filter((t=>t.hitsNumber<t.length));for(const n of e)if(Z.containsLocation(t,n.getLocations()))return n}static makeGrid(t){t.save(),t.beginPath(),t.lineWidth=st.state.gridLineThickness,t.setLineDash([3,3]);const e=st.state;let n=st.getters.getCanvasWidth(e),i=st.getters.getCanvasHeight(e),a=st.getters.getGridCellWidth(e),s=st.getters.getGridCellHeight(e);for(let o=0;o<=n;o+=a)t.moveTo(o,0),t.lineTo(o,i);for(let o=0;o<=i;o+=s)t.moveTo(0,o),t.lineTo(n,o);t.stroke(),t.restore()}static drawShips(t){t.save();const e=st.state;let n=st.getters.getCanvasWidth(e),i=st.getters.getCanvasHeight(e);t.clearRect(0,0,n,i),this.makeGrid(t),Z.ships.forEach((e=>e.draw(t))),t.restore()}static containsLocation(t,e){for(const n of e)if(n.x===t.x&&n.y===t.y)return!0;return!1}static getDiagonalLocations(t){let e=[];for(let n=-1;n<=1;n++)for(let i=-1;i<=1;i++){let a=t.x+n,s=t.y+i;0===n||0===i||a<0||s<0||a>9||s>9||e.push(new q(a,s))}return e}static allShipsAreSunk(){return Z.ships.every((t=>t.length===t.hitsNumber))}static async highlightDiagonals(t,e){for(const n of e)await n.highlight(t)}static addToShotHistory(t){Z.containsLocation(t,Z.shotHistory)||Z.shotHistory.push(t)}static async clearShotHistory(){Z.shotHistory=[]}}(0,F.A)(Z,"ships",void 0),(0,F.A)(Z,"shotHistory",[]);class tt{static createWebSocket(t){let e=tt.WS_SERVER_HOST,n=tt.WS_SERVER_PORT,i=new WebSocket(`ws://${e}:${n}/client/${t}/ws`);return i}static setupWSAndCreateGameOnOpen(t,e){t.onopen=function(n){console.log("Opening a connection..."),tt.ws=t,t.send(JSON.stringify(e)),console.log("Successfully connected to the websocket server")},t.onmessage=async function(t){await at.processData(t.data)},t.onerror=function(t){console.log("Connection error")},t.onclose=function(t){t.wasClean?console.log("Connection closed correctly"):console.error("The connection was broken")}}static getWebSocket(){return tt.ws}}var et;(0,F.A)(tt,"ws",void 0),(0,F.A)(tt,"WS_SERVER_HOST","91.245.227.98"),(0,F.A)(tt,"WS_SERVER_PORT",5e3),function(t){t[t["MISS"]=1]="MISS",t[t["HIT"]=2]="HIT",t[t["SUNK"]=3]="SUNK"}(et||(et={}));var nt=et;class it{static async showAlert(t,e="danger",n=3e3){lt.commit("setAlert",{alertText:t,alertColor:e}),setTimeout(it.hideAlert,n)}static hideAlert(){lt.commit("hideAlert")}}class at{static getEnemyUUID(){return at.enemyClientUuid}static getGameId(){return at.gameId}static async processData(t){let e=JSON.parse(t);switch(e.msg_type){case j.GAME_CREATION:console.log("MessageType.GAME_CREATION data:",e),e.is_status_ok&&at.processGameCreation(e.data);break;case j.SHIPS_ARE_ARRANGED:console.log("MessageType.SHIPS_ARE_ARRANGED data:",e),e.is_status_ok&&at.processShipArrangement(e.data);break;case j.PLAY:console.log("MessageType.PLAY data:",e),e.is_status_ok&&await at.processStartingToPlay(e.data);break;case j.FIRE_REQUEST:console.log("MessageType.FIRE_REQUEST data:",e),e.is_status_ok&&await at.processFireRequest(e.data);break;case j.FIRE_RESPONSE:console.log("MessageType.FIRE_RESPONSE data:",e),e.is_status_ok&&await at.processFireResponse(e.data);break;case j.GAME_OVER:console.log("MessageType.GAME_OVER data:",e),e.is_status_ok&&await at.processGameOver(e.data);break;case j.UNSUNK_SHIPS:console.log("MessageType.UNSUNK_SHIPS data:",e),e.is_status_ok&&await at.processUnsunkShips(e.data);break;case j.DISCONNECTION:console.log("MessageType.DISCONNECTION data:",e),e.is_status_ok&&await at.processDisconnection(e.data);break;case j.PLAY_AGAIN:console.log("MessageType.PLAY_AGAIN data:",e),e.is_status_ok&&await at.processPlayAgain(e.data);break;default:break}}static getGameCreationBody(t,e,n=""){const i={msg_type:j.GAME_CREATION,game_type:t,nickName:e};return t===Y.FRIEND&&n&&(i.enemy_client_id=n),i}static processGameCreation(t){at.gameId=t.gameId,lt.commit("setMyState",V.SHIPS_POSITIONING),lt.commit("setEnemyState",V.SHIPS_POSITIONING),lt.commit("setEnemyNickname",t.enemy_nickname)}static processShipArrangement(t){lt.commit("setEnemyState",V.SHIPS_ARE_ARRANGED),at.enemyClientUuid=t.enemy_client_id}static async processStartingToPlay(t){lt.commit("setEnemyState",V.PLAYING),lt.commit("setMyState",V.PLAYING),lt.commit("setMyTurnToShoot",t.turn_to_shoot),t.turn_to_shoot&&await lt.dispatch("enableShooting")}static async processFireRequest(t){let e=new q(t.shot_location._x,t.shot_location._y),n=K.CIRCLE,i=lt.getters.getContext2D,a={msg_type:j.FIRE_RESPONSE,shot_result:nt.MISS,enemy_client_id:at.enemyClientUuid},s=Z.getShipByLocation(e);if(s){n=K.CROSS,s.hitsNumber++;let t=Z.getDiagonalLocations(e);if(await Z.highlightDiagonals(i,t),s.hitsNumber<s.length)a.shot_result=nt.HIT;else{a.shot_result=nt.SUNK;let t={length:s.length,loc:{_x:s.location.x,_y:s.location.y},type:s.type};a.sunkShip=t;let e=await ct.getFrontAndBackLocations(t.length,t.loc._x,t.loc._y,t.type);for(const n of e)await n.highlight(i);if(Z.allShipsAreSunk()){lt.commit("setMyState",V.GAME_IS_OVER),lt.commit("setEnemyState",V.GAME_IS_OVER);const t=tt.getWebSocket();t.send(JSON.stringify({msg_type:j.GAME_OVER,enemy_client_id:at.enemyClientUuid}))}}await lt.dispatch("disableShooting")}else await lt.dispatch("enableShooting");await e.highlight(i,n);const o=tt.getWebSocket();o.send(JSON.stringify(a)),lt.commit("setEnemyShotHint",e.toString())}static async processFireResponse(t){let e=lt.getters.getHostileContext2D,n=at.currentShot;if(Z.addToShotHistory(n),t.shot_result===nt.MISS)await n.highlight(e),lt.commit("setEnemyShotHint",""),await lt.dispatch("disableShooting");else{await n.highlight(e,K.CROSS);let i=Z.getDiagonalLocations(n);await Z.highlightDiagonals(e,i);for(const t of i)Z.addToShotHistory(t);if(t.shot_result===nt.SUNK){let n=t.sunkShip;if(n){let t=await ct.getFrontAndBackLocations(n.length,n.loc._x,n.loc._y,n.type);for(const n of t)await n.highlight(e);for(const e of t)Z.addToShotHistory(e)}}}}static async processGameOver(t){lt.commit("setMyState",V.GAME_IS_OVER),lt.commit("setEnemyState",V.GAME_IS_OVER),lt.commit("setIsWinner",!0),await lt.dispatch("disableShooting"),await this.sendUnsunkShipsToEnemy()}static async processUnsunkShips(t){let e=t.unSunkShips.map((t=>new ct(t.length,t.type,new q(t.loc._x,t.loc._y)))),n=lt.getters.getHostileContext2D;e.forEach((t=>t.draw(n,"red")))}static async processDisconnection(t){it.showAlert("К сожалению, ваш соперник разорвал соединение и вышел из игры. Обновите страницу для новой игры","danger",1e4),lt.commit("setMyState",V.NOT_CREATED),lt.commit("setEnemyState",V.NOT_CREATED)}static async processPlayAgain(t){it.showAlert("Соперник хочет сыграть с Вами снова","success",15e3),lt.commit("setEnemyState",V.SHIPS_POSITIONING)}static handleHostileGridClick(t){let e=q.getLocationByOffsetXY(t.offsetX,t.offsetY);if(!e.isValid())return;if(Z.existsInShotHistory(e))return void it.showAlert("Вы уже стреляли сюда","warning");at.currentShot=e;const n=tt.getWebSocket();n.send(JSON.stringify({msg_type:j.FIRE_REQUEST,shot_location:e,enemy_client_id:at.enemyClientUuid}))}static async sendUnsunkShipsToEnemy(){const t=tt.getWebSocket();let e={msg_type:j.UNSUNK_SHIPS,enemy_client_id:at.enemyClientUuid,unSunkShips:[]},n=Z.getShips().filter((t=>t.hitsNumber<t.length));for(const i of n)e.unSunkShips.push({loc:{_x:i.location.x,_y:i.location.y},length:i.length,type:i.type});t.send(JSON.stringify(e))}}(0,F.A)(at,"currentShot",void 0),(0,F.A)(at,"enemyClientUuid",void 0),(0,F.A)(at,"gameId",void 0);const st={state:{scaleParameter:.9,gridLineThickness:.3,canvasWidth:300,canvasHeight:300,numberOfCellsOnTheAxisX:10,numberOfCellsOnTheAxisY:10,context2D:CanvasRenderingContext2D,hostileContext2D:CanvasRenderingContext2D,handlers:{pointerDownHandler:Function,pointerMoveHandler:Function,pointerUpHandler:Function,touchStartHandler:Function},alert:{alertVisible:!1,alertText:"",alertColor:"danger"},myState:V.NOT_CREATED,enemyState:V.NOT_CREATED,enemyNickname:"",enemyClientUuid:"",isMyTurnToShoot:!1,enemyShotHint:"",isWinner:!1},getters:{getCanvasWidth(t){return t.canvasWidth*t.scaleParameter},getCanvasHeight(t){return t.canvasHeight*t.scaleParameter},getGridCellWidth(t){return t.canvasWidth*t.scaleParameter/t.numberOfCellsOnTheAxisX},getGridCellHeight(t){return t.canvasHeight*t.scaleParameter/t.numberOfCellsOnTheAxisY},getContext2D(t){return t.context2D},getHostileContext2D(t){return t.hostileContext2D},getAlert(t){return t.alert},getMyState(t){return t.myState},getEnemyNickname(t){return t.enemyNickname},getEnemyState(t){return t.enemyState},getEnemyClientUuid(t){return t.enemyClientUuid},getIsMyTurnToShoot(t){return t.isMyTurnToShoot},getEnemyShotHint(t){return t.enemyShotHint},getIsWinner(t){return t.isWinner}},mutations:{setContext2D(t,e){t.context2D=e},setContextHostile2D(t,e){t.hostileContext2D=e},setHandlers(t,e){const{pointerDownHandler:n,pointerMoveHandler:i,pointerUpHandler:a,touchStartHandler:s}=e;t.handlers.pointerDownHandler=n,t.handlers.pointerMoveHandler=i,t.handlers.pointerUpHandler=a,t.handlers.touchStartHandler=s},setAlert(t,{alertText:e,alertColor:n}){t.alert.alertVisible=!0,t.alert.alertColor=n,t.alert.alertText=e},hideAlert(t){t.alert.alertVisible=!1},setMyState(t,e){t.myState=e},setEnemyState(t,e){t.enemyState=e},setEnemyNickname(t,e){t.enemyNickname=e},setEnemyClientUuid(t,e){t.enemyClientUuid=e},setMyTurnToShoot(t,e){t.isMyTurnToShoot=e},setEnemyShotHint(t,e){t.enemyShotHint=e},setIsWinner(t,e){t.isWinner=e}},actions:{async addOwnGridEventListeners({state:t}){const e=t.context2D.canvas;e.addEventListener("pointerdown",t.handlers.pointerDownHandler),e.addEventListener("pointermove",t.handlers.pointerMoveHandler),e.addEventListener("pointerup",t.handlers.pointerUpHandler),e.addEventListener("touchstart",t.handlers.touchStartHandler)},async removeOwnGridEventListeners({state:t}){const e=t.context2D.canvas;e.removeEventListener("pointerdown",t.handlers.pointerDownHandler),e.removeEventListener("pointermove",t.handlers.pointerMoveHandler),e.removeEventListener("pointerup",t.handlers.pointerUpHandler),e.removeEventListener("touchstart",t.handlers.touchStartHandler)},async enableShooting({commit:t,state:e}){const n=e.hostileContext2D.canvas;n.addEventListener("click",at.handleHostileGridClick),t("setMyTurnToShoot",!0)},async disableShooting({commit:t,state:e}){const n=e.hostileContext2D.canvas;n.removeEventListener("click",at.handleHostileGridClick),t("setMyTurnToShoot",!1)}}},ot={state:{rusCaptions:{loserHeader:"Поражение!",winnerHeader:"Победа!",loserText:"Ваш соперник оказался сильнее! Но не отчаивайтесь, попробуйте еще раз!",winnerText:"Поздравляю, противник повержен. Вы выиграли этот бой!"}},getters:{getCaptions(t){return t.rusCaptions}},mutations:{},actions:{}};var rt,lt=(0,W.y$)({state:{},getters:{},mutations:{},actions:{},modules:{GameStore:st,CaptionStore:ot}});class ct{constructor(t,e,n){(0,F.A)(this,"_length",void 0),(0,F.A)(this,"_type",void 0),(0,F.A)(this,"_location",void 0),(0,F.A)(this,"_hitsNumber",void 0),this._length=t,this._type=e,this._location=n,this._hitsNumber=0}get length(){return this._length}set length(t){this._length=t}get type(){return this._type}set type(t){this._type=t}get location(){return this._location}set location(t){this._location=t}get hitsNumber(){return this._hitsNumber}set hitsNumber(t){this._hitsNumber=t}draw(t,e="black"){let n,i;if(t){t.save(),t.strokeStyle=e,t.lineWidth=2;let a=lt.getters.getGridCellWidth,s=lt.getters.getGridCellHeight;this._type===$.Horizontal?(n=this._length*a,i=s):(n=a,i=this._length*s),this.drawBulkhead(t),t.strokeRect(this._location.x*a+1,this._location.y*s+1,n-2,i-2),t.restore()}}drawBulkhead(t){if(t){t.beginPath();for(let e=1;e<this._length;e++){let n=lt.getters.getGridCellWidth,i=lt.getters.getGridCellHeight,a=this._location.x*n,s=this._location.y*i;this._type===$.Horizontal?(t.moveTo(a+e*n,s),t.lineTo(a+e*n,s+i)):(t.moveTo(a,s+e*i),t.lineTo(a+n,s+e*i))}t.stroke()}}changeOrientation(){this._type===$.Horizontal?this._type=$.Vertical:this._type=$.Horizontal}getLocations(){let t=[this._location];if(this._type===$.Horizontal)for(let e=1;e<this._length;e++)t.push(new q(this._location.x+e,this._location.y));else for(let e=1;e<this._length;e++)t.push(new q(this._location.x,this._location.y+e));return t}static async getFrontAndBackLocations(t,e,n,i){let a=[];if(1===t)for(let s=-1;s<=1;s++)for(let t=-1;t<=1;t++){let i=e+s,o=n+t;s*s+t*t!==1||i<0||o<0||i>9||o>9||a.push(new q(i,o))}else if(i===$.Horizontal){let i=new q(e-1,n),s=new q(e+t,n);i.x>=0&&a.push(i),s.x<=9&&a.push(s)}else{let i=new q(e,n-1),s=new q(e,n+t);i.y>=0&&a.push(i),s.y<=9&&a.push(s)}return a}isIntersect(t){for(const e of this.getLocations())for(const n of t.getLocations())if(Math.abs(e.x-n.x)<=1&&Math.abs(e.y-n.y)<=1)return[!0,e,n];return[!1,void 0,void 0]}}(function(t){t["Own"]="OWN",t["Hostile"]="HOSTILE"})(rt||(rt={}));var dt=rt,ht=(0,a.pM)({name:"BattleGridComponent",props:{gridType:{type:String,default:dt.Own}},data(){return{selectedShip:new ct(1,$.Horizontal,new q(0,0)),currentTimeStamp:0}},computed:{...(0,W.L8)(["getCanvasWidth","getCanvasHeight"])},methods:{getContext(){let t=this.$refs.canvas;return t.getContext("2d")},changeShipOrientation(t,e){if(this.crossesBorderWithBackLocation(t,e,!0))return void lt.commit("setAlert",{alertText:"При изменении положения - этот корабль выйдет за границы сетки. Переместите корабль подальше от границы",alertColor:"danger"});t.changeOrientation();let n=this.getContext();n&&(Z.drawShips(n),this.checkArrangementAndHighlight(n))},handlePointerDown(t){t.preventDefault();let e=this.$refs.canvas,n=q.getLocationByOffsetXY(t.offsetX,t.offsetY),i=Z.getShipByHeadLocation(n);if(i){let t=Date.now()-this.currentTimeStamp;this.currentTimeStamp=Date.now(),t<=500&&this.changeShipOrientation(i,n),this.selectedShip=i,e.addEventListener("pointermove",this.handlePointerMove)}},handlePointerMove(t){let e=q.getLocationByOffsetXY(t.offsetX,t.offsetY);if(!e.outsideTheGrid()&&this.selectedShip){if(this.crossesBorderWithBackLocation(this.selectedShip,e))return;this.selectedShip.location=e;let t=this.getContext();t&&Z.drawShips(t)}},handlePointerUp(t){let e=this.$refs.canvas,n=e.getContext("2d");e.removeEventListener("pointermove",this.handlePointerMove),this.selectedShip=null,n&&this.checkArrangementAndHighlight(n)},handleTouchStart(t){t.preventDefault()},async registerOwnGridHandlers(){const t=this.handlePointerDown,e=this.handlePointerMove,n=this.handlePointerUp,i=this.handleTouchStart;lt.commit("setHandlers",{pointerDownHandler:t,pointerMoveHandler:e,pointerUpHandler:n,touchStartHandler:i}),await lt.dispatch("addOwnGridEventListeners")},checkArrangementAndHighlight(t){let e=Z.isArrangementCorrect();e[0]||e[1]?.forEach((e=>e.highlight(t,K.SQUARE)))},crossesBorderWithBackLocation(t,e,n=!1){let i=$.Horizontal;n?t.type===$.Horizontal&&(i=$.Vertical):i=t.type;let a=new ct(t.length,i,e),s=a.getLocations(),o=s[s.length-1];return o.outsideTheGrid()}},async mounted(){let t=this.getContext();t&&(t.canvas.width=this.getCanvasWidth,t.canvas.height=this.getCanvasHeight,Z.makeGrid(t),Z.createInitialShips(),this.gridType===dt.Own?(Z.getShips().forEach((e=>{e.draw(t)})),lt.commit("setContext2D",t),await this.registerOwnGridHandlers()):lt.commit("setContextHostile2D",t))}});const ut=(0,c.A)(ht,[["render",M],["__scopeId","data-v-17a9eb54"]]);var gt=ut,mt=(0,a.pM)({name:"BattleGridWithCaptionsComponent",components:{BattleGridComponent:gt},props:{gridType:{type:String,default:dt.Own}},computed:{...(0,W.L8)(["getCanvasWidth","getCanvasHeight"])}});const pt=(0,c.A)(mt,[["render",D],["__scopeId","data-v-2a081d56"]]);var yt=pt,St=(0,a.pM)({name:"BattleBoardComponent",components:{BattleGridWithCaptionsComponent:yt},props:{isMyTurnToShoot:{type:Boolean,default:!1},turnOrderHintsVisible:{type:Boolean,default:!1},enemyShotHint:{type:String,default:""},enemyNickname:{type:String,default:""}},data(){return{hostileGrid:dt.Hostile}}});const ft=(0,c.A)(St,[["render",G]]);var _t=ft;const kt={class:"card-header bg-transparent fs-4"},vt={class:"card-body"},Ct={class:"card-text fw-bold"};function bt(t,e,n,i,s,o){return(0,a.uX)(),(0,a.CE)("div",{class:(0,m.C4)(["card text-center mb-4",[t.isWinner?"gold":"text-white bg-secondary grey-border"]])},[(0,a.Lk)("div",kt,(0,m.v_)(t.isWinner?t.getCaptions.winnerHeader:t.getCaptions.loserHeader),1),(0,a.Lk)("div",vt,[(0,a.Lk)("p",Ct,(0,m.v_)(t.isWinner?t.getCaptions.winnerText:t.getCaptions.loserText),1)])],2)}var Et=(0,a.pM)({name:"GameOverInfoComponent",props:{isWinner:{type:Boolean,default:!1}},data(){return{}},computed:{...(0,W.L8)(["getCaptions"])},methods:{}});const At=(0,c.A)(Et,[["render",bt],["__scopeId","data-v-2948fdd4"]]);var It=At,wt=n.p+"img/refresh-icon.de9c08cd.png";const Lt={id:"table"},Nt={class:"text-center"},Tt={id:"canvas",ref:"canvas"};function Ot(t,e,n,s,o,r){return(0,a.uX)(),(0,a.CE)("table",Lt,[(0,a.Lk)("tbody",null,[e[5]||(e[5]=(0,a.Lk)("tr",null,[(0,a.Lk)("td",{colspan:"2"},[(0,a.Lk)("p",{class:"fs-6 fw-bold text-nowrap"},"Введите текст с картинки")])],-1)),(0,a.Lk)("tr",null,[(0,a.Lk)("td",null,[(0,a.Lk)("div",Nt,[(0,a.Lk)("canvas",Tt,null,512)])]),(0,a.Lk)("td",null,[(0,a.Lk)("button",{class:"btn btn-outline-light w-100 minw",type:"button",onClick:e[0]||(e[0]=(...e)=>t.refreshCaptcha&&t.refreshCaptcha(...e))},e[4]||(e[4]=[(0,a.Lk)("img",{id:"img",src:wt,alt:"refresh"},null,-1)]))])]),(0,a.Lk)("tr",null,[(0,a.Lk)("td",null,[(0,a.bo)((0,a.Lk)("input",{class:"form-control",placeholder:"Текст с картинки",type:"text","onUpdate:modelValue":e[1]||(e[1]=e=>t.userText=e),onKeyup:e[2]||(e[2]=(0,i.jR)((e=>t.$emit("captchaOkButtonClicked",t.getComparisonResult())),["enter"]))},null,544),[[i.Jo,t.userText]])]),(0,a.Lk)("td",null,[(0,a.Lk)("button",{class:"btn btn-dark w-100",type:"button",onClick:e[3]||(e[3]=e=>t.$emit("captchaOkButtonClicked",t.getComparisonResult()))}," OK ")])])])])}var Rt=(0,a.pM)({name:"CaptchaComponent",emits:{captchaOkButtonClicked(t){return!0}},data(){return{chars:"A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,0,1,2,3,4,5,6,7,8,9,$,%,&",numberOfCharsForCaptcha:4,canvasWidth:150,canvasHeight:40,captchaLetters:[],userText:""}},methods:{getComparisonResult(){return this.captchaLetters.join("")===this.userText.toUpperCase()},async refreshCaptcha(){let t=this.$refs.canvas;const e=t.getContext("2d");if(e){t.width=this.canvasWidth,t.height=this.canvasHeight,e.save(),e.font="bold 25px serif",e.textBaseline="top",e.textAlign="left",this.captchaLetters=this.generateCodeArray();for(let t=0;t<this.captchaLetters.length;t++){let n=Math.random()*Math.PI/10,i=10*t+10,a=4*Math.random();e.translate(i,a),e.rotate(n),e.fillStyle=this.getRandomColor(),e.fillText(this.captchaLetters[t],0,0),e.rotate(-n)}e.restore(),this.addLine(e)}},addLine(t){t.strokeStyle=this.getRandomColor(),t.beginPath(),t.moveTo(0,this.canvasHeight/2),t.lineTo(this.canvasWidth-30,this.canvasHeight/2),t.stroke()},generateCodeArray(){let t=this.chars.split(","),e=[];for(let n=0;n<this.numberOfCharsForCaptcha;n++){const n=this.getRandomInt(t.length);e.push(t[n])}return e},getRandomInt(t){return Math.floor(Math.random()*t)},getRandomColor(){let t=this.getRandomInt(256),e=this.getRandomInt(256),n=this.getRandomInt(256);return"rgb("+t+","+e+","+n+")"}},async mounted(){await this.refreshCaptcha()}});const Ht=(0,c.A)(Rt,[["render",Ot],["__scopeId","data-v-1f0229a4"]]);var xt=Ht,Gt=n.p+"img/arrang_rule.6c54c16e.png";const Dt={class:"container"};function Pt(t,e,n,i,s,o){return(0,a.uX)(),(0,a.CE)("div",Dt,e[0]||(e[0]=[(0,a.Lk)("div",{class:"d-flex flex-row flex-wrap justify-content-center"},[(0,a.Lk)("div",{class:"p-3"},[(0,a.Lk)("div",{class:"badge text-bg-dark text-wrap p-3 fs-6 minmaxw custom-style"},[(0,a.Lk)("p",null,"Перемещай корабли используя первую клетку корабля."),(0,a.Lk)("p",null,"Двойной клик по ней меняет положение корабля")])]),(0,a.Lk)("div",null,[(0,a.Lk)("img",{src:Gt,alt:"arrang_rule"})])],-1)]))}var Mt=(0,a.pM)({name:"ArrangementRuleComponent"});const Ut=(0,c.A)(Mt,[["render",Pt],["__scopeId","data-v-64a7d82b"]]);var Ft=Ut;const Wt={class:"container text-center pt-2 pb-2"},Bt={class:"custom-min-width"},Vt=["value"],Xt=["disabled"];function Yt(t,e,n,i,s,o){return(0,a.uX)(),(0,a.CE)("div",Wt,[(0,a.Lk)("table",Bt,[(0,a.Lk)("tbody",null,[e[1]||(e[1]=(0,a.Lk)("tr",{class:"text-nowrap"},[(0,a.Lk)("td",null,"Ваш id (отправь другу)")],-1)),(0,a.Lk)("tr",null,[(0,a.Lk)("td",null,[(0,a.Lk)("input",{class:"form-control",type:"text",disabled:"",value:t.clientUUID},null,8,Vt)])]),(0,a.Lk)("tr",null,[(0,a.Lk)("td",null,[(0,a.Lk)("input",{class:"form-control",type:"text",placeholder:"Введи id друга и нажми создать игру",onInput:e[0]||(e[0]=e=>t.$emit("friendUUIDUpdated",e.target.value)),disabled:t.friendInputDisabled},null,40,Xt)])])])])])}var zt=(0,a.pM)({name:"FriendGameComponent",emits:{friendUUIDUpdated(t){return!0}},props:{clientUUID:{type:String,default:""},friendInputDisabled:{type:Boolean,default:!1}}});const jt=(0,c.A)(zt,[["render",Yt],["__scopeId","data-v-e7b293c2"]]);var Qt=jt;const $t={key:0,class:"text-center fs-5 blink"},Kt={key:1,class:"text-center fs-5 blink"},Jt={key:2,class:"text-center fs-5 blink"},qt={key:3,class:"card border-success text-center mb-4"},Zt={class:"card-body text-success"},te={class:"card-title"},ee={class:"darkred"},ne={key:0,class:"card-footer bg-transparent border-success text-success"},ie={key:4,class:"text-center mb-lg-4 mb-5"};function ae(t,e,n,i,s,o){return t.isSearchingForEnemy()?((0,a.uX)(),(0,a.CE)("p",$t," Поиск соперника... ")):t.isWaitingForEnemyToPlayAgain()?((0,a.uX)(),(0,a.CE)("p",Kt," Ждем соперника... ")):t.isWaitingForFriend()?((0,a.uX)(),(0,a.CE)("p",Jt," Ждем друга... ")):t.isEnemyPositioningOrArranged()?((0,a.uX)(),(0,a.CE)("div",qt,[(0,a.Lk)("div",Zt,[(0,a.Lk)("h5",te,[e[0]||(e[0]=(0,a.eW)(" Ваш соперник: ")),(0,a.Lk)("strong",ee,(0,m.v_)(t.enemyNickName),1)]),(0,a.Lk)("p",{class:(0,m.C4)(["card-text text-dark",{blink:t.isEnemyPositioningOrArranged}])},(0,m.v_)(t.getEnemyStateCaption()),3)]),t.enemyNickName?((0,a.uX)(),(0,a.CE)("div",ne,' Расставьте корабли и нажмите кнопку "Играть" ')):(0,a.Q3)("",!0)])):((0,a.uX)(),(0,a.CE)("p",ie,(0,m.v_)(t.getEnemyStateCaption()),1))}var se=(0,a.pM)({name:"StateInfoComponent",props:{enemyNickName:{type:String,default:""},enemyState:{type:Number,default:V.NOT_CREATED},myState:{type:Number,default:V.NOT_CREATED}},data(){return{}},methods:{isSearchingForEnemy(){return 1===this.myState},isWaitingForEnemyToPlayAgain(){return this.myState===V.SHIPS_POSITIONING&&this.enemyState===V.GAME_IS_OVER},isWaitingForFriend(){return this.myState===V.WAITING_FOR_FRIEND},isEnemyPositioningOrArranged(){return this.enemyState===V.SHIPS_POSITIONING||this.enemyState===V.SHIPS_ARE_ARRANGED},getEnemyStateCaption(){switch(this.enemyState){case V.SHIPS_POSITIONING:return"расставляет корабли...";case V.SHIPS_ARE_ARRANGED:return"расставил корабли и готов играть";case V.PLAYING:return"Игра началась";default:break}}}});const oe=(0,c.A)(se,[["render",ae]]);var re=oe,le=n(7507),ce=n(1645),de=n(5196),he=n(4817),ue=n(9828),ge=(0,a.pM)({name:"BattleShipView",components:{BattleBoardComponent:_t,StateInfoComponent:re,GameOverInfoComponent:It,CaptchaComponent:xt,ArrangementRuleComponent:Ft,FriendGameComponent:Qt},data(){return{gameType:Y.RANDOM,nickName:"",topButtonDisabled:!1,isPlaying:!1,captchaVisible:!0,clientUUID:"",friendUUID:"",friendInputDisabled:!1}},computed:{...(0,W.L8)(["getMyState","getEnemyState","getEnemyNickname","getEnemyShotHint","getIsMyTurnToShoot","getIsWinner","getAlert"])},methods:{isStateInfoComponentVisible(){return this.getMyState!==V.NOT_CREATED&&this.getMyState!==V.GAME_IS_OVER},isPlayButtonEnabled(){return this.getMyState===V.SHIPS_POSITIONING&&(this.getEnemyState===V.SHIPS_POSITIONING||this.getEnemyState===V.SHIPS_ARE_ARRANGED)||this.getMyState===V.GAME_IS_OVER},hideAlert(){lt.commit("hideAlert")},isFriendGameNotCreated(){return this.gameType===Y.FRIEND&&this.getMyState===V.NOT_CREATED},processCaptcha(t){this.topButtonDisabled=!t,this.captchaVisible=!t,t||it.showAlert("Неверный код","danger")},validateAndSetFriendUUID(t){try{let e=(0,le.A)((0,ce.A)(t));if(e===de.A||e===he.A)return void it.showAlert("Некорректный UUID (NIL/MAX UUID)","danger",3e3);if(e===this.clientUUID)return void it.showAlert("UUID ваш и друга не могут совпадать","danger",5e3);this.friendUUID=e,it.showAlert("UUID валидный","success",5e3)}catch(e){it.showAlert("Невалидный UUID","danger",7e3)}},preventNavAndUnload(t){this.isPlaying&&(t.preventDefault(),t.returnValue="")},isNickNameValid(){let t=this.nickName.trim().length;if(0===t)return it.showAlert("Ник не должен быть пустым!","warning"),!1;let e=25;return!(t>e)||(it.showAlert(`Максимальная длина ника ${e} символов!`,"warning"),!1)},handleGameCreation(){this.gameType===Y.RANDOM?lt.commit("setMyState",V.SEARCHING_FOR_OPPONENT):lt.commit("setMyState",V.WAITING_FOR_FRIEND);let t=tt.createWebSocket(this.clientUUID),e=at.getGameCreationBody(this.gameType,this.nickName.trim(),this.friendUUID);tt.setupWSAndCreateGameOnOpen(t,e)},handleRandomGameButtonClick(){this.isNickNameValid()&&(this.isPlaying?it.showAlert("Игра уже создана или в процессе создания. Для новой игры необходимо обновить страницу!","warning",7e3):(this.isPlaying=!0,this.clientUUID=(0,ue.A)(),this.handleGameCreation()))},handleFriendGameButtonClick(){this.isNickNameValid()&&(this.isPlaying?it.showAlert("Игра уже создана или в процессе создания. Для новой игры необходимо обновить страницу!","warning",7e3):(this.isPlaying=!0,this.gameType=Y.FRIEND,this.clientUUID=(0,ue.A)()))},handleCreateFriendGameButtonClick(){this.friendUUID?this.handleGameCreation():it.showAlert("Некорректный id друга","warning",5e3)},async handlePlayButtonClick(t){if(!this.isPlaying)return void it.showAlert("Игра еще не создана. Выберите тип игры с помощью кнопок выше","warning",5e3);if(0===Z.getShips().length)return void it.showAlert("Корабли отсутствуют, необходимо почистить куки и обновить страницу!");if(Z.clearShotHistory(),!Z.isArrangementCorrect()[0])return void it.showAlert("Корабли расставлены некорректно!");if(this.getMyState===V.GAME_IS_OVER)return void await this.handlePlayAgain();lt.commit("setMyState",V.SHIPS_ARE_ARRANGED);const e=tt.getWebSocket();e.send(JSON.stringify({msg_type:j.SHIPS_ARE_ARRANGED,game_id:at.getGameId()})),lt.dispatch("removeOwnGridEventListeners")},async handlePlayAgain(){Z.refreshGridAndShips(),lt.commit("setMyState",V.SHIPS_POSITIONING),lt.commit("setIsWinner",!1),lt.commit("setEnemyShotHint",""),await lt.dispatch("addOwnGridEventListeners");const t=tt.getWebSocket();t.send(JSON.stringify({msg_type:j.PLAY_AGAIN,game_id:at.getGameId(),enemy_client_id:at.getEnemyUUID()}))},getPlayButtonCaption(){let t=this.gameType===Y.RANDOM?"Играть еще раз с тем же соперником":"Играть с другом еще раз";return this.getMyState===V.GAME_IS_OVER?t:"Играть"}},beforeRouteLeave(t,e,n){if(this.isPlaying){if(!window.confirm("Игра будет завершена при переходе на другую вкладку. Перейти на другую вкладку ?"))return;tt.getWebSocket().close()}n()},beforeMount(){window.addEventListener("beforeunload",this.preventNavAndUnload)},beforeUnmount(){window.removeEventListener("beforeunload",this.preventNavAndUnload)}});const me=(0,c.A)(ge,[["render",N],["__scopeId","data-v-792dca3d"]]);var pe=me;const ye=[{path:"/",name:"battle",component:pe}],Se=(0,g.aE)({history:(0,g.LA)("/"),routes:ye});var fe=Se;n(8077);(0,i.Ef)(u).use(lt).use(fe).mount("#app")}},e={};function n(i){var a=e[i];if(void 0!==a)return a.exports;var s=e[i]={exports:{}};return t[i].call(s.exports,s,s.exports,n),s.exports}n.m=t,function(){var t=[];n.O=function(e,i,a,s){if(!i){var o=1/0;for(d=0;d<t.length;d++){i=t[d][0],a=t[d][1],s=t[d][2];for(var r=!0,l=0;l<i.length;l++)(!1&s||o>=s)&&Object.keys(n.O).every((function(t){return n.O[t](i[l])}))?i.splice(l--,1):(r=!1,s<o&&(o=s));if(r){t.splice(d--,1);var c=a();void 0!==c&&(e=c)}}return e}s=s||0;for(var d=t.length;d>0&&t[d-1][2]>s;d--)t[d]=t[d-1];t[d]=[i,a,s]}}(),function(){n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,{a:e}),e}}(),function(){n.d=function(t,e){for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){n.p="/"}(),function(){var t={524:0};n.O.j=function(e){return 0===t[e]};var e=function(e,i){var a,s,o=i[0],r=i[1],l=i[2],c=0;if(o.some((function(e){return 0!==t[e]}))){for(a in r)n.o(r,a)&&(n.m[a]=r[a]);if(l)var d=l(n)}for(e&&e(i);c<o.length;c++)s=o[c],n.o(t,s)&&t[s]&&t[s][0](),t[s]=0;return n.O(d)},i=self["webpackChunkbattleship"]=self["webpackChunkbattleship"]||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))}();var i=n.O(void 0,[504],(function(){return n(5089)}));i=n.O(i)})();
//# sourceMappingURL=app.652b6d8a.js.map